<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Examples - GREENGAGE Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../css/custom.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Examples";
        var mkdocs_page_input_path = "tools/keycloak/examples/index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> GREENGAGE Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../../guidelines">Guidelines</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../HOWTO%20Thematic%20co-explorations/">HOWTO Thematic co-exploration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../thematic_coexploration_example/">Thematic co-exploration example</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Backbone</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Keycloak</a>
    <ul>
                <li class="toctree-l3"><a class="" href="..">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../integration">Integration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Examples</a>
    <ul>
                <li class="toctree-l4"><a class="" href="../examples#nodejs">Node</a>
                </li>
                <li class="toctree-l4"><a class="" href="../examples#python">Python</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Community and Co-production process Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Wordpress</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../wordpress">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../wordpress/integration">Integration</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../wordpress/examples">Example of deployment</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Discourse</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../Discourse">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../Discourse/integration">Integration</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../Discourse/examples">Example of deployment</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Collaborative Environment</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../collaborativeEnvironment">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../collaborativeEnvironment/usage">Usage</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../collaborativeEnvironment/examples">Example of deployment</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data crowdsourcing and capture</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >MODE</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../mode">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../mode/integration">Integration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Examples</a>
    <ul>
                <li class="toctree-l4"><a class="" href="../../mode/examples/ios">iOS</a>
                </li>
                <li class="toctree-l4"><a class="" href="../../mode/examples/android">Android</a>
                </li>
                <li class="toctree-l4"><a class="" href="../../mode/examples/backend">Backend</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >MindView</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../mindview">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../mindview/integration">Integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Libelium sensor integration</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../sensorsIntegration">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../sensorsIntegration/integration">Integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Greengage App</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../greengage-app-api">Description</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Examples</a>
    <ul>
                <li class="toctree-l4"><a class="" href="../../greengage-app-api/examples/client-js">clientJs</a>
                </li>
                <li class="toctree-l4"><a class="" href="../../greengage-app-api/examples/restful-to-graphql">client Restful to graphql</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Data analysis and insights generation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >UrbanTEP / VISAT</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../urbantep-visat">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../urbantep-visat/deployment">Deployment</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../urbantep-visat/integration">Integration</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../urbantep-visat/examples">Example</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >DataHub</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../datahub">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../datahub/usage">Usage</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../datahub/examples">Example of integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Apache Superset</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../superset">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../superset/usage">Usage</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../superset/examples">Example of integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Apache Druid</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../druid">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../druid/usage">Usage</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../druid/examples">Example of integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Apache NiFi</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../nifi">Description</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../nifi/usage">Usage</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../nifi/examples">Example of integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Data Quality Dashboard</a>
    <ul>
                <li class="toctree-l3"><a class="" href="../../DataQualityDashboard">Description</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">GREENGAGE Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Examples</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="examples">Examples</h1>
<p>This section includes examples in different programming languages on how integration with the provided KeyCloak can be performed.</p>
<h2 id="nodejs"><a href="#Nodejs">Nodejs</a></h2>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>Docker and Docker Compose installed.</li>
<li>Node.js and npm installed.</li>
<li>Basic understanding of Keycloak, Docker, and Node.js.</li>
</ul>
<h3 id="project-structure">Project Structure</h3>
<p>Source: <a href="https://github.com/Greengage-project/Documentation/tree/main/docs/tools/keycloak/examples/node">example</a></p>
<pre><code>example/
|-- docker-compose.yml
|-- realm-export.json
|-- keycloak.json
|-- package.json
|-- index.js
|-- run.sh         (for Linux/macOS)
|-- run.bat        (for Windows)
</code></pre>
<h3 id="step-1-setting-up-keycloak">Step 1: Setting Up Keycloak</h3>
<ol>
<li>
<p><strong>docker-compose.yml</strong>:</p>
</li>
<li>
<p>This file contains the configuration to run a Keycloak container.</p>
</li>
<li>
<p>Make sure the <code>docker-compose.yml</code> file is set up as provided in your project.</p>
</li>
<li>
<p><strong>realm-export.json</strong>:</p>
</li>
<li>This file should be configured according to your Keycloak realm requirements.</li>
<li>It contains realm, client, user, and role configurations.</li>
</ol>
<h3 id="step-2-setting-up-nodejs-application">Step 2: Setting Up Node.js Application</h3>
<ol>
<li>
<p><strong>package.json</strong>:</p>
</li>
<li>
<p>This file contains your project metadata and dependencies.</p>
</li>
<li>
<p>Ensure <code>express</code>, <code>express-session</code>, and <code>keycloak-connect</code> dependencies are listed.</p>
</li>
<li>
<p><strong>index.js</strong>:</p>
</li>
<li>
<p>This file contains your Express application setup.</p>
</li>
<li>
<p>It sets up routes for login, logout, and the home page which displays the JWT.</p>
</li>
<li>
<p><strong>keycloak.json</strong>:</p>
</li>
<li>
<p>This file contains the Keycloak client configuration.</p>
</li>
<li>
<p>Update the <code>realm</code>, <code>resource</code>, and <code>credentials</code> fields with your Keycloak configuration.</p>
</li>
<li>
<p><strong>Installing Dependencies</strong>:</p>
</li>
<li>Run the following command to install the necessary packages as listed in your <code>package.json</code>:</li>
</ol>
<pre><code class="language-bash">npm i
</code></pre>
<h3 id="step-3-running-the-services">Step 3: Running the Services</h3>
<ol>
<li>
<p><strong>Linux/macOS</strong>:</p>
</li>
<li>
<p>Ensure <code>run.sh</code> is executable: <code>chmod +x run.sh</code>.</p>
</li>
<li>
<p>Execute <code>run.sh</code> to start the services: <code>./run.sh</code>.</p>
</li>
<li>
<p><strong>Windows</strong>:</p>
</li>
<li>Double-click <code>run.bat</code> or run it in the command prompt to start the services.</li>
</ol>
<h3 id="accessing-the-application">Accessing the Application</h3>
<ol>
<li>Navigate to <code>localhost:3000/auth</code> to log in using Keycloak.</li>
<li>Once logged in, navigate to <code>localhost:3000</code> to view the JWT and its decoded payload.</li>
<li>To logout, navigate to <code>localhost:3000/logout</code>.</li>
</ol>
<hr />
<h3 id="step-1-install-and-setup-keycloak">Step 1: Install and Setup Keycloak</h3>
<ol>
<li>Download and install Keycloak from the <a href="https://www.keycloak.org/downloads.html">official website</a>.</li>
<li>Start Keycloak by navigating to the <code>bin</code> directory of your Keycloak installation and executing the <code>standalone.sh</code> (for Linux/macOS) or <code>standalone.bat</code> (for Windows) script.</li>
<li>Access the Keycloak Admin Console at <code>http://localhost:8080/auth</code> and complete the initial setup. Create an admin user for managing Keycloak.</li>
</ol>
<h3 id="step-2-create-a-realm-and-a-client-openid-connect">Step 2: Create a Realm and a Client (OpenID Connect)</h3>
<ol>
<li>
<p><strong>Create a New Realm:</strong></p>
</li>
<li>
<p>Navigate to the Keycloak Admin Console.</p>
</li>
<li>Click on "Add realm" to create a new realm.</li>
<li>
<p>Enter the required details for your realm and save.</p>
</li>
<li>
<p><strong>Register a Client:</strong></p>
</li>
<li>
<p>Navigate to <code>Clients</code> and click <code>Create</code>.</p>
</li>
<li>Provide a <code>Client ID</code>, and select the <code>Client Protocol</code> as <code>openid-connect</code>.</li>
<li>Select the <code>Client Access Type</code> as <code>confidential</code> if your client is a web application that can secure the client secret. Otherwise, select <code>public</code> if your client is a native app or a JavaScript app running in the browser.</li>
<li>
<p>Set <code>Standard Flow Enabled</code> to <code>ON</code> if you want to use the Authorization Code Flow which is recommended for most scenarios.</p>
</li>
<li>
<p><strong>Configure OpenID Connect Protocol:</strong></p>
</li>
<li>
<p>For each client, you can tailor what claims and assertions are stored in the OIDC token by creating and configuring protocol mappers.</p>
</li>
<li>
<p>You may need to set up JSON mapping for certain claim keys in your application to handle roles or other claims passed by Keycloak.</p>
</li>
<li>
<p><strong>Client Adapters:</strong></p>
</li>
<li>
<p>Install a Keycloak Adapter in your application environment to communicate and be secured by Keycloak. Keycloak provides adapters for different platforms, and there are also third-party adapters available.</p>
</li>
<li>
<p><strong>Test Your Setup:</strong></p>
</li>
<li>
<p>At this point, it would be prudent to test your setup by attempting to authenticate using OpenID Connect. There are various grant types supported by Keycloak for authenticating users including authorization code, implicit, and client credentials.</p>
</li>
<li>
<p><strong>Additional Configuration (Optional):</strong></p>
</li>
<li>
<p>Depending on your application's requirements, you might need to configure additional settings in Keycloak or in your application. For instance, you might need to set up user roles, groups, and permissions, or configure multi-factor authentication.</p>
</li>
<li>
<p><strong>Documentations and Tutorials:</strong></p>
</li>
<li>There are various resources available that provide step-by-step guides or tutorials on integrating OpenID Connect with Keycloak, including the <a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_oidc">Keycloak official documentation</a>.</li>
</ol>
<p>This extended step should provide a more thorough understanding of how to integrate OpenID Connect with Keycloak. However, the exact steps might vary based on your application's technology stack and your specific requirements.</p>
<h3 id="step-3-configure-your-system">Step 3: Configure your System</h3>
<ol>
<li>For a JavaScript application, you could use the Keycloak JavaScript adapter.</li>
</ol>
<pre><code class="language-javascript">npm install keycloak-js
</code></pre>
<p>or a middleware as <em>keycloak-connect</em></p>
<pre><code class="language-javascript">npm install keycloak-connect
</code></pre>
<ol>
<li>Configure the library with the details of your Keycloak realm and client.</li>
</ol>
<pre><code class="language-javascript">// Example configuration for a JavaScript application
const keycloak = Keycloak({
  url: &quot;http://localhost:8080/auth&quot;,
  realm: &quot;&lt;your-realm&gt;&quot;,
  clientId: &quot;&lt;your-client-id&gt;&quot;,
});
</code></pre>
<h3 id="step-4-integrate-authentication">Step 4: Integrate Authentication</h3>
<ol>
<li>Use the library to add authentication to your system. For a web application, this would typically involve redirecting unauthenticated users to the Keycloak login page, and handling the tokens returned by Keycloak upon successful authentication.</li>
</ol>
<pre><code class="language-javascript">// Example integration for a JavaScript application
keycloak
  .init({ onLoad: &quot;login-required&quot; })
  .then((authenticated) =&gt; {
    console.log(authenticated ? &quot;Authenticated&quot; : &quot;Not authenticated&quot;);
  })
  .catch((error) =&gt; {
    console.error(&quot;Failed to initialize authentication&quot;, error);
  });
</code></pre>
<h3 id="step-5-integrate-authorization">Step 5: Integrate Authorization</h3>
<ol>
<li>Use the tokens obtained during authentication to make authorized requests to your system's backend, and to check the user's roles and permissions.</li>
</ol>
<pre><code class="language-javascript">// Example authorization check in a JavaScript application
if (keycloak.hasRealmRole(&quot;admin&quot;)) {
  console.log(&quot;User is an admin&quot;);
}
</code></pre>
<p>This tutorial provides a high-level overview of the steps involved in integrating Keycloak with your system. The exact steps and code may vary depending on the specifics of your system and the programming languages and frameworks you are using.</p>
<hr />
<h2 id="python"><a href="#Python">Python</a></h2>
<h4 id="prerequisites_1">Prerequisites</h4>
<ul>
<li>Docker and Docker Compose installed.</li>
<li>Python and pip installed.</li>
<li>Basic understanding of Keycloak, Docker, Flask, and Python.</li>
<li>Access the application over HTTPS and accept the self-signed certificate warning: "The certificate is not trusted because it is self-signed."</li>
</ul>
<h3 id="project-structure_1">Project Structure</h3>
<p>Source: <a href="https://github.com/Greengage-project/Documentation/tree/main/docs/tools/keycloak/examples/python">example</a></p>
<pre><code>example/
|-- docker-compose.yml
|-- realm-export.json
|-- client_secrets.json
|-- requirements.txt
|-- index.py
|-- run.sh         (for Linux/macOS)
|-- run.bat        (for Windows)
</code></pre>
<h3 id="step-1-setting-up-keycloak_1">Step 1: Setting Up Keycloak</h3>
<ol>
<li>
<p><strong>docker-compose.yml</strong>:</p>
</li>
<li>
<p>This file contains the configuration to run a Keycloak container.</p>
</li>
<li>
<p>Ensure it's set up as provided in your project.</p>
</li>
<li>
<p><strong>realm-export.json</strong>:</p>
</li>
<li>Configure this file according to your Keycloak realm requirements.</li>
<li>It contains realm, client, user, and role configurations.</li>
</ol>
<h3 id="step-2-setting-up-python-flask-application">Step 2: Setting Up Python Flask Application</h3>
<ol>
<li>
<p><strong>requirements.txt</strong>:</p>
</li>
<li>
<p>Lists the necessary Python packages, including Flask and Flask-OIDC.</p>
</li>
<li>
<p><strong>client_secrets.json</strong>:</p>
</li>
<li>
<p>Contains Keycloak client configuration.</p>
</li>
<li>
<p>Update the <code>client_id</code>, <code>client_secret</code>, and URLs according to your Keycloak setup.</p>
</li>
<li>
<p><strong>index.py</strong>:</p>
</li>
<li>Contains your Flask application.</li>
<li>Sets up routes for login, logout, and home page displaying user information.</li>
</ol>
<h3 id="step-3-installing-dependencies">Step 3: Installing Dependencies</h3>
<ul>
<li>Run the following command to install necessary Python packages:</li>
</ul>
<pre><code class="language-bash">pip install -r requirements.txt
</code></pre>
<h3 id="step-4-running-the-services">Step 4: Running the Services</h3>
<ol>
<li>
<p><strong>Linux/macOS</strong>:</p>
</li>
<li>
<p>Make <code>run.sh</code> executable: <code>chmod +x run.sh</code>.</p>
</li>
<li>
<p>Execute <code>run.sh</code> to start the services: <code>./run.sh</code>.</p>
</li>
<li>
<p><strong>Windows</strong>:</p>
</li>
<li>Execute <code>run.bat</code> to start the services.</li>
</ol>
<h3 id="accessing-the-application_1">Accessing the Application</h3>
<ol>
<li>Navigate to <code>https://localhost:3000/</code> (accept the self-signed certificate warning).</li>
<li>Use the Keycloak authentication process to log in.</li>
<li>Once logged in, user information will be displayed on the home page.</li>
<li>To logout, navigate to <code>https://localhost:3000/logout</code>.</li>
</ol>
<hr />
<h3 id="important-notes">Important Notes</h3>
<ul>
<li>Ensure all URLs in <code>client_secrets.json</code> and <code>realm-export.json</code> match your Keycloak configuration.</li>
<li>Remember to access the application via HTTPS and accept the browser warning about the self-signed certificate.</li>
<li>Modify the <code>index.py</code> file to suit your application's specific Flask and OIDC needs.</li>
</ul>
<hr />
<p><strong>For more information you can visit the official documentation in <a href="https://www.keycloak.org/documentation">https://www.keycloak.org/documentation</a></strong></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../javascripts/custom.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
